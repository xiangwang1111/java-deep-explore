# <span style="color: red; font-size: 48px;">创造 · 奉献 · 陪伴</span>

> 这是准备与国内某顶尖大学出版社合作出版的《Java深度探索》一书的交付稿，在即将初审之际，却因出版社内部原因无法面世-_-!!!<br>好歹也耗费了大半年的心血，所以就索性开源了吧。

<br>

# 内容简介

- 本系列书籍以Java语言为引，分为三大部分，分别是“开发基础篇”、“应用技术篇”和“工程实践篇”。

- 开发基础篇从实际工作中会经常接触到的基本概念开始，笔者由浅入深地阐述了Java编程语言中的重、难点问题，包括多线程和JVM GC这两大难倒很多新手工程师的“拦路虎”。并继而延伸到Java开发中较为前沿的技术领域：函数式编程、反应式编程和Java协程，为读者后续学习铺垫下坚实的基础。

- 应用技术篇详细介绍了笔者在过往工作当中或实际负责过的，或参与开发过的具有代表性的应用案例，包括支付系统设计模式、认证与权限、可靠消息最终一致性、用Netty实现物联网、规则引擎与风控系统以及Nginx中的OpenResty。通过这六个典型案例，让读者站在业务发展和系统架构的高度，了解到一个健壮、稳定、易用、易维护且可扩展的应用平台中的关键技术点有哪些。

- 最后，在工程实践篇中，笔者从软件开发中的建模语言讲起，将源码管理、接口设计、远程调试、静态检查、自动化部署、开发模式、软件开源诸多的“工程化”知识点串联起来。让读者逐步了解并具备成为一名合格的架构师乃至CTO所应有的专业和职业素养。

- 本书适合所有想提升技术硬实力和软实力的广大技术开发人员。本书中所澄清的技术概念，所讲解的相关技术的重、难点，所展示的应用实践案例，所提供的诸多“技术捷径”和可执行脚本，所附赠的大量学习资源，也使得它适合成为广大技术开发人员的“词典式”案头参考书。

# 主要内容

全书共分为三大部分十八个章节，对各篇及其各章节的内容介绍如下。

- 第1部分：开发基础篇。包括第1章编程常识，第2章Java关键特性，第3章多线程，第4章JVM GC，第5章函数式编程，第6章反应式编程，第7章Java协程，共七章。

  - 第1章讲解了开发人员应该掌握的计算机编程常识的最小集合，包括冯诺依曼架构、二进制的内涵、算法与数据结构、同步异步和回调、并行与并发、缓冲与缓存、http与https、国际化与本地化等。这些看似简单的常识与具体编程语言和工作性质无关，但对于提高自身的技术素养并向更高层次迈进，却是不可或缺的。

  - 第2章讲解了Java中的关键特性，包括数据类型、抽象类和接口、泛型、注解、反射和代理。目前大多数主流的开源开发框架，如Spring中所使用的主要技术，无非就是这几个Java特性的组合而已。在彻底理解它们的基础之上，再去阅读那些优秀开源项目的源码时，才会真正吃透作者的设计思想和实现思路。

  - 第3章从多线程生命周期的厘清开始，一直讲到JUC（java.util.concurrent，Java并发工具包），为读者详细梳理了一番作为Java“镇教之宝”的多线程。对于大多数工程师来说，多线程既难于理解掌握，又是面试官最爱问的杀手锏问题。笔者在此深入浅出，带着读者领略多线程别样的魅力。

  - 第4章通过一步一图的方式，将JVM的设计理念、分代模型、触发机制、日志分析以及各种不同的垃圾回收方式向读者娓娓道来。和多线程一样，JVM也是Java中比较晦涩难懂的存在。笔者结合自身实际开发和调优经验，通过一个个鲜活的案例和代码，让读者对JVM越学越上瘾，越学越忍不住跃跃欲试。

  - 第5章讲解了首次在Java 8中发布的函数式编程范式。由于Lambda表达式“怪异”的语法让诸多新手感觉不适应，故而笔者从它产生的源头开始讲起，到如何平滑地过渡到习惯使用Lambda表达式和函数式接口，直至它如何与“流”及流式计算相配合，完美地解决以往开发工作中面临的诸多的“小麻烦”。

  - 第6章介绍了Java的反应式编程范式。作为一种“另类”的编程方式，它不仅全盘继承了函数式编程的全部特性，而且又融入了发布-订阅的观察者模式、变动传递、背压、异步边界等诸多新特性。由于它天然的异步特性，因此非常适合用于构建分布式、高响应度的应用服务后台，以及在不牺牲性能的前提下处理大量且异步的实时数据流，例如社交应用。

  - 第7章讲解了Java中最新的协程技术。它最早随着JDK 19在JEP 425中作为预览版发布，称为Virtual Threads虚拟线程，最终JDK 21将其在JEP 444中正式确定下来。虚拟线程，即协程作为实际物理线程的映射，突破了操作系统物理线程数量的限制，而且由JDK完全控制。这样既避免了上下文切换的额外损耗，兼顾了多线程的优点，又能显著地提高应用程序的吞吐量。

- 第2部分：应用技术篇。包括第8章支付系统设计模式，第9章认证与权限，第10章可靠消息最终一致性，第11章用Netty实现物联网，第12章规则引擎与风控系统，第13章Nginx与OpenResty，共六章。

  - 第8章讲解了针对业务、产品、技术、运营部门先后提出的数次需求改进，笔者在支付系统中尝试使用了若干种设计模式，以应对和拥抱这种变化，提升开发效率。所用到的设计模式包括策略模式、构造器模式、模板方法模式、外观模式、状态模式、备忘录模式等。阅读这一章前需要读者先具备一些设计模式的相关知识，这样理解起来会更容易一些。这部分内容作为付费阅读，已经放在了[CSDN专栏《支付系统中的设计模式》](https://blog.csdn.net/lostrex/article/details/129149387)中。

  - 第9章讲解了一般应用系统中后台管理的权限设计问题。从借鉴Spring Security框架拦截机制开始，到实现自定义的RBAC权限系统，让读者知晓权限设计的关键技术点有哪些。接着介绍并实现当前流行的OAuth 2.0开放授权机制，并以Github代替微信实现了OAuth 2.0的第三方登录。同时还展示了如何接受其他应用的申请，成为“第三方”。之后介绍了动态令牌的原理，并将之与OAuth 2.0结合。

  - 第10章讲解了分布式事务的“521”知识：五大解决方案、两大定理和一个框架，对它们进行了较为详细的说明和比较后，最终基于Spring Cloud Alibaba实现了可靠消息最终一致性方案。通过对代码的讲解，清楚地阐明了该方案的关键点在于保存并发送事务消息和实现事务消息轮询。这部分内容作为付费阅读，已经放在了[CSDN专栏《基于SpringCloud的可靠消息最终一致性》](https://blog.csdn.net/lostrex/article/details/129179394)中。

  - 第11章讲解了支撑IoT（Internet of Things，物联网）发展的核心技术——Netty及其背后的RPC机制，演示了XML-RPC、JSON-RPC和gRPC这三种不同的RPC实现，最后再以一个实际案例，向读者展示了如何通过Netty及自定义的通信协议，来完成物联网服务端与终端之间的双向通信和数据采集。这部分内容作为付费阅读，已经放在了[CSDN专栏《用Netty实现物联网》](https://blog.csdn.net/lostrex/article/details/129176005)中。

  - 第12章讲解了规则引擎Drools是如何嵌入在应用程序中，通过使用预定义的语义模块编写业务决策，接受数据输入，解释业务规则，然后以此来实现业务约束，抵御各类薅羊毛的高风险行为的，同时也介绍了另外两种轻量级的规则引擎Groovy和Aviator。然后在此基础上，介绍了基于大数据实施风控的Clickhouse和Flink，尤其是指标采样存储、行为序列聚合和模式事件匹配这三种核心技术。这部分内容作为付费阅读，已经放在了[CSDN专栏《规则引擎与风控系统》](https://blog.csdn.net/lostrex/article/details/129177938)中。

  - 第13章讲解了轻量级、高性能的HTTP和反向代理服务器Nginx，以及它能实现的各种流量控制功能，包括负载均衡、流量限制、流量拷贝等。借助于Nginx和OpenResty的LUA脚本，OpenResty把Nginx“升级”为一个强大的Web应用服务器，并通过其协程特性，能轻松构建出处理上万并发请求的超高性能Web应用。更能随心所欲地制定复杂的访问控制、业务处理和安全检测规则。

- 第3部分：工程实践篇。包括第14章字不如表不如图，第15章接口、调试与代码检查，第16章源码管理与流水线，第17章开发过程与质量管理，第18章开源知多少，共五章。

  - 第14章讲解了在整个软件研发的生命周期中，开发人员必定会高频接触到的一些图表，包括UML、ER图和架构图等，掌握这些图表的绘制方法和技巧，在沟通时能起到事半功倍的效果。

  - 第15章讲解了常见的接口开发、远程调试方法和代码检查方法。编写优雅且性能优良的应用程序接口，是每个工程师都非常关心的问题，笔者对此从规范建议、幂等性和文档方面做了说明。而如果能够像调试本地代码一样调试远程服务器上的代码，那无疑将大大加快开发进程，提升开发效率。对于大公司而言，代码质量直接决定码农们的考评绩效，所以需要挑选一款好用的工具。

  - 第16章讲解了源代码的托管方式、几种不同的版本管理策略、编译构建工具和流水线部署方式。就像工程的脚手架一样，所有的这些都是为了能够更好地管理软件公司的核心资产——代码，并让其能够顺利、平稳地转化为软件产品。不同的公司或开发团队可以根据自己的情况选择合适的源代码版本管理策略，既提高效率又避免麻烦。而掌握了流水线部署工具之后，就无需像以往那样费时费力地人工部署了。

  - 第17章讲解了目前几种主流的软件开发过程和一种软件质量管理流程。这几种软件开开发过程分别是瀑布模型、RUP和Agile敏捷软件开发过程。瀑布模型多用于大型企事业及科研项目，只有这种按部就班的方式才能逐渐推进；而RUP基于瀑布模型，提出了一种改良的瀑布：迭代式增量开发。敏捷则非常适于小型开发团队的快速交付。基于CMMI的软件能力成熟度模型不仅仅评价的是软件，更是对一个组织开发能力的评估。能够通过CMMI4及以上级别的软件公司，基本上都是业界翘楚。

  - 第18章讲解了关于开源的一些知识。包括开源中的协作模式和所谓许可证的概念。开源并不意味着免费，而是另外一种和商业付费不同的软件运作模式。它发展至今已经混合了免费、自由、著作权（即版权）属左等诸多理念，更有商业公司下场参与开源社区的建设与发展。因此，如果不真正明白开源意味着什么，反而会因此陷入麻烦之中。

# 序

自2008年接触Java以降，至今已过去十多个年头。

一路走来，笔者作为实习生整理过若干技术文档、需求说明、用户手册；作为工程师开发过多个软件应用；作为QA把控过研发过程和系统的质量；作为PM主导过大大小小的项目团队；作为SA也画过诸多架构设计图；作为创业技术负责人接触并满足过形形色色的客户需求。在此期间，虽然技术在不断地迭代升级，工具在不停地持续改进，包括低代码、AI等诸多新技术也在一波又一波涌现，但从宏观上来说，软件开发的思想、原则、模式、流程、架构、方法直到现在也没有发生多大变化——无非是从C/S换到B/S，再到PC + APP/小程序；无非是从过去的网络主机升级为现在的云服务器；无非是用IDEA替换了Eclipse，用Git淘汰了SVN；也无非是在SOA中演化出了微服务，在Java中引入了新的特性和编程范式，而又在虚拟机中孵化了docker容器......。

从入行伊始至今时今日，笔者多年来一直就有一个小小的心愿：希冀市面上有一本关于技术研发的“词典”式案头参考书——既能将理论与实际相结合，将技术与工程相结合，将开发与管理相结合，又能贯穿众多基础概念，解答开发中的疑难杂症，有最前沿的技术应用案例，同时还能杜绝空谈，践行极致的Geek精神，“以术证道”，“授人以渔”。让工程师们得以明确自己今后的职业工作内容、方向和目标——这是大多数刚步入职场不久的新手工程师们都必需且缺乏的。所以，一方面，这种“引路人”或“教练”角色的缺位，是导致新手们在初期成长极为痛苦的原因之一：不但无法迅速提升研发能力，而且目标不清，方向不明，倍感挫折，更让不少人直接“从入门到放弃”。另一方面，尽管现今市面上有不少专门谈“道”的名篇，也有大量仅仅论“术”的佳作，但仍然缺乏那种能“上九天揽月”，能“下五洋捉鳖”，且能完整地呈现研发全过程的的技术书籍。

此外，但凡有几年研发经验的软件工程师想必也都有这样的体会：除了需求和业务逻辑的个别差异，其实每次所开发的软件系统和应用平台基本上没什么不同。以电商和O2O为例，尽管业态不同，但会员、商品、店铺、支付、营销、订单生产、履约、仓储（广义上的）、结算、物流、售后、评价等限界上下文（或子域）的技术实现环节，没什么本质上的区别。即使是两者之间的大数据分析/统计、风控模型也是大同小异。再进一步讲，就算是拿电子商务与电子政务系统相比，开发所使用的开发模式、架构模式、设计模式、技术中间件、开发工具、运行环境可能都没有任何分别，甚至研发团队都是同一拨人。

有鉴于上述种种，笔者本着“自己动手，丰衣足食”的理念，也为了尽可能节省广大读者的宝贵时间，将自身多年的开发经验、失败教训和实践技巧都融入到了本书之中，同时附以大量完整的案例代码、配置模板、脚本文件。

希望此书能帮助广大读者找到并见证属于自己的“Eureka Moment！”

<br>
<hr>
<br>

# 本书资源

1. 源代码：

  - [javabook-base](https://github.com/xiangwang1111/javabook-base)：第一篇《开发基础》部分的源代码。因为Java的依赖包之间可能会造成一些冲突，导致项目无法启动或正常运行，所以笔者在`javabook-base`的`pom.xml`文件中有相应的注释说明，只需找到“Begin”和“End”之间的部分即可。

  - [javabook-cloud](https://github.com/xiangwang1111/javabook-cloud)：第二篇《应用技术》部分的源代码。这是一个`Spring Cloud Alibaba`项目，包含了`javabook-core`、`javabook-application`、`javabook-transaction`、`javabook-iotandnetty`、`javabook-riskcontrol`和`javabook-nginxlua`这六个子模块，其中：

    - `javabook-core`：是所有其他子模块都需要依赖的子模块；
    - `javabook-application`：《第8章 支付系统设计模式》（见[CSDN专栏《支付系统中的设计模式》](https://blog.csdn.net/lostrex/article/details/129149387)）和《第9章 认证与授权》的源代码；
    - `javabook-transaction`：《第10章 可靠消息最终一致性》（见[CSDN专栏《基于SpringCloud的可靠消息最终一致性》](https://blog.csdn.net/lostrex/article/details/129179394)）的源代码；
    - `javabook-iotandnetty`：《第11章 用Netty实现物联网》（见[CSDN专栏《用Netty实现物联网》](https://blog.csdn.net/lostrex/article/details/129176005)）的源代码；
    - `javabook-riskcontrol`：《第12章 规则引擎与风控系统》（见[CSDN专栏《规则引擎与风控系统》](https://blog.csdn.net/lostrex/article/details/129177938)）的源代码；
    - `javabook-nginxlua`：《第13章 Nginx与OpenResty》的源代码。

  - [javabook-practice](https://github.com/xiangwang1111/javabook-practice)：第三篇《工程实践》部分的源代码。

2. 项目中用到的相关数据库脚本、shell脚本文件、项目配置文件，如无特别说明，均统一放在每个项目源代码各自的`src/main/resources`目录下。

3. 章节名称xxx.md对应的本章内容资源目录。例如，`chapter01.md`章节中所有的插图（.graffle源文件）、脑图、日志文件、类图、excel文件、脚本等，都在`chapter01`目录中。

4. 如无特别声明，本书所有的代码、应用和其他相关软件的运行环境如下：

  - MacOS (Intel i9八核) 14.1.2 (23B92) Sonoma；
  - Windows 10专业版 22H2-19045.2364（虚拟机）；
  - CentOS 7.9.2009(Core)×64（虚拟机）；
  - Docker 20.10.8；
  - Oracle JDK1.8.0_391、Oracle JDK-12.0.2、Oracle JDK 21.0.1；
  - VMware Fusion Pro 12.2.5(20904517)；
  - Navicat Premium 15.0.29；
  - StarUML 3.2.2；
  - OmniGraffle 7.22.5 (GM-v205.43.4)；
  - OmniPlan 3.14.4 (v202.14.0)；
  - XMind 8 Update 9 (R3.7.9.201912052356)。
